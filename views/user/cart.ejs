<%- include("../layout/head") %>
  <link rel="stylesheet" href="css/body.css">

  <%- include("../layout/nav") %>

    <!------------------->
    <body>
        <div class="container">
          <h3>Giỏ hàng</h3>
          <div class="row">
            <table class="table table-striped table-bordered">
              <tr>
                <th>Ảnh</th>
                <th>Tên sản phẩm</th>
                <th>Đơn giá</th>
                <th>Số lượng</th>
                <th>Thành tiền</th>
              </tr>
              <% var total=0; if(data){ data.forEach(function(item){ total +=item.price %>
                <tr>
                  <td><a
                      href="/chi-tiet/<%= item.item.nameKhongDau%>.<%= item.item._id%>.<%= item.item.cateId%>.html"><img
                        title="product" alt="product" src="/upload/<%= item.item.image%>" height="100" width="200"></a>
                  </td>
                  <td><a href="/chi-tiet/<%= item.item.nameKhongDau%>.<%= item.item._id%>.<%= item.item.cateId%>.html">
                      <%= item.item.name%>
                    </a></td>
  
                  <td>
                    <%= item.item.price%> đ
                  </td>
  
                  <td>
                    <span>
                      <input 
                        id="<%= item.item._id%>" 
                        type="number" size="1" 
                        min="1" max="<%= item.item.quantity%>" 
                        value="<%= item.qty%>" 
                        oninput="checkMaxValue(this)" 
                        name="quantity[40]"
                        class="span1">
                    </span>
                      <br>
                    <span id="maxErrorMessage" style="color: red; margin-top: 20px;"></span>
                  </td>
                  
                  <td>
                    <%= item.price%> đ
                  </td>
                  <td>
                    <a href="/view/<%= item._id %>">Xem</a> |
                    <a href="/xoa/<%= item._id %>">Xóa</a>
                  </td>
                </tr>

                <%})}%>
            </table>
          </div>
          <div class="pull-right">
            <div class="span4 pull-right">
              <table class="table table-striped table-bordered ">
                <td><span class="extra bold totalamout">Tổng tiền :</span></td>
                <td><span class="bold totalamout">
                    <%= total%> đ
                  </span></td>
                </tr>
              </table>
              <a href="/order" class="btn btn-success" style="float: right;">Đặt Hàng</a>
          </div>
            </div>
          </div>
        </div>
      <%- include("../layout/footer") %>
    </body>

    <script>
      var data = JSON.parse(decodeURIComponent(`<%- encodeURIComponent(JSON.stringify(data)); %>`));
      function checkMaxValue(input) {
        var max = parseInt(input.max, 10);
        var value = parseInt(input.value, 10);
        if (value > max) {
          document.getElementById("maxErrorMessage").textContent = "Số lượng nhỏ hơn" + max;
        } else {
          document.getElementById("maxErrorMessage").textContent = "";
        }
      }
   </script>